<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <!-- Page refreshes after 180s (3 minutes). Adjust as needed. -->
  <meta http-equiv="refresh" content="180">
  <title>QR Code Auto-Refresh Demo</title>

  <!-- QRCode.js library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    #pageContent {
      text-align: center;
      margin-top: 50px;
    }
    #qrcode {
      margin: 20px auto;
      width: 256px;
      height: 256px;
    }
    /* Small, subtle text at the bottom of the page */
    #currentLink {
      font-size: 0.7em;
      color: #666;        /* Gray color for less distraction */
      text-align: center;
      margin: 10px 0;    /* Some spacing above/below */
    }
  </style>
</head>
<body>

  <!-- Main content in the middle -->
  <div id="pageContent">
    <h1>QR Code That Updates Before Page Refresh</h1>
    <p>
      This page refreshes every 3 minutes (180s). 
      The QR code updates a few seconds before that.
    </p>
    <!-- Container for the QR code -->
    <div id="qrcode"></div>
  </div>

  <!-- Debug text at the bottom, small & gray -->
  <p id="currentLink"></p>

  <script>
    // Replace with your actual Google Forms link
    const BASE_FORM_URL = "https://docs.google.com/forms/d/EXAMPLE_FORM_ID/viewform";

    let qrCodeObj = null;

    // Generates a unique version of your form URL so the QR code pattern changes
    function getRandomFormURL() {
      const uniqueParam = Date.now();
      return `${BASE_FORM_URL}?unique=${uniqueParam}`;
    }

    // Updates the QR code in the browser
    function updateQRCode() {
      const newURL = getRandomFormURL();

      if (!qrCodeObj) {
        // First-time creation
        qrCodeObj = new QRCode(document.getElementById("qrcode"), {
          text: newURL,
          width: 256,
          height: 256
        });
      } else {
        // If already created, just update
        qrCodeObj.makeCode(newURL);
      }

      // Display the link at the bottom in a small, subtle font
      document.getElementById("currentLink").innerText = `Current QR Code URL: ${newURL}`;
    }

    // 1) Generate the initial QR code when the page loads
    updateQRCode();

    // 2) Update the QR code a bit before full refresh (e.g., 5 seconds earlier)
    //    If meta refresh is 180s, do 175s for 5s gap:
    const TIME_BEFORE_REFRESH = (180 - 5) * 1000; // 175 * 1000 = 175000 ms
    setTimeout(updateQRCode, TIME_BEFORE_REFRESH);
  </script>
</body>
</html>
